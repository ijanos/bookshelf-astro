---
import { type Book } from "../types/book.ts";
import type { ImageMetadata } from "astro";
import BookCoverSvg from "./BookCoverSvg.astro";
import { Image } from 'astro:assets';

interface Props {
    book: Book;
}

const { book } = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>('/covers/*.{jpeg,jpg,png,gif}')

const ids = book.id || {};

let coverFile = null;
for (const [key, value] of Object.entries(ids)) {
  const f = `${key}__${value}`.toLowerCase();
  const cover = Object.entries(images).find(img => img[0].toLocaleLowerCase().includes(f));
  if (cover) {
    coverFile = cover[1];
    break;
  }
}

---
{ coverFile ? <Image src={coverFile()} width="200" alt={book.title} /> :  <BookCoverSvg book={book}/> }
